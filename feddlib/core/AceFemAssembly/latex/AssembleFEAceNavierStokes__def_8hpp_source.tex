\hypertarget{AssembleFEAceNavierStokes__def_8hpp_source}{}\doxysection{Assemble\+FEAce\+Navier\+Stokes\+\_\+def.\+hpp}
\label{AssembleFEAceNavierStokes__def_8hpp_source}\index{specific/AssembleFEAceNavierStokes\_def.hpp@{specific/AssembleFEAceNavierStokes\_def.hpp}}
\mbox{\hyperlink{AssembleFEAceNavierStokes__def_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef ASSEMBLEFEACENAVIERSTOKES\_DEF\_hpp}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define ASSEMBLEFEACENAVIERSTOKES\_DEF\_hpp}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{AssembleFEAceNavierStokes__decl_8hpp}{AssembleFEAceNavierStokes\_decl.hpp}}"{}}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceFEDD}{FEDD}} \{}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{9 \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a8ce04708bc97ffe80efbd687ce1c061a}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::AssembleFEAceNavierStokes}}(\textcolor{keywordtype}{int} flag, vec2D\_dbl\_Type nodesRefConfig, ParameterListPtr\_Type params,tuple\_disk\_vec\_ptr\_Type tuple):}
\DoxyCodeLine{10 \mbox{\hyperlink{classFEDD_1_1AssembleFE}{AssembleFE}}<\mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}},\mbox{\hyperlink{fe__test__laplace_8cpp_ad6a38c9f07d3fd633eefca5bccad8410}{LO}},\mbox{\hyperlink{fe__test__laplace_8cpp_afa2946b509009b4f45eb04bd8c5b27d9}{GO}},\mbox{\hyperlink{fe__test__laplace_8cpp_a5e24f37b28787429872b6ecb1d0417ce}{NO}}>(flag, nodesRefConfig, params,tuple)}
\DoxyCodeLine{11 \{}
\DoxyCodeLine{12     \textcolor{keywordtype}{int} locVelocity=0;}
\DoxyCodeLine{13     \textcolor{keywordtype}{int} locPressure=0;      }
\DoxyCodeLine{14     \textcolor{keywordflow}{if}(std::get<0>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(0))==\textcolor{stringliteral}{"{}Velocity"{}})\{}
\DoxyCodeLine{15         locVelocity=0;}
\DoxyCodeLine{16         locPressure=1;}
\DoxyCodeLine{17     \}}
\DoxyCodeLine{18     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(std::get<0>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(1))==\textcolor{stringliteral}{"{}Velocity"{}})\{}
\DoxyCodeLine{19         locVelocity=1;}
\DoxyCodeLine{20         locPressure=0;}
\DoxyCodeLine{21     \}}
\DoxyCodeLine{22     \textcolor{keywordflow}{else}}
\DoxyCodeLine{23         TEUCHOS\_TEST\_FOR\_EXCEPTION( \textcolor{keyword}{true}, std::logic\_error, \textcolor{stringliteral}{"{}No discretisation Information for Velocity in Navier Stokes Element."{}} );}
\DoxyCodeLine{24         }
\DoxyCodeLine{25 }
\DoxyCodeLine{28     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a1dde809cd07180ecf9533c6de93fa058}{FETypeVelocity\_}} = std::get<1>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locVelocity));}
\DoxyCodeLine{29     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a96a5a860ce08afa0a42461e446522ace}{FETypePressure\_}} =std::get<1>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locPressure));}
\DoxyCodeLine{30 }
\DoxyCodeLine{31     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ab9f645b7c95c753306f55b0719c320c4}{dofsVelocity\_}} = std::get<2>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locVelocity));}
\DoxyCodeLine{32     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_abf1541abe26336013363cacacb149443}{dofsPressure\_}} =std::get<2>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locPressure));}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a3a8035f008772690f30636987062d2f9}{numNodesVelocity\_}} = std::get<3>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locVelocity));}
\DoxyCodeLine{35     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a37566d3b2a185a5b83277f811d4697ae}{numNodesPressure\_}}=std::get<3>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(locPressure));}
\DoxyCodeLine{36 }
\DoxyCodeLine{37     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a5a962e0f07c7887831259dcce56b107c}{dofsElementVelocity\_}} = \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ab9f645b7c95c753306f55b0719c320c4}{dofsVelocity\_}}*\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a3a8035f008772690f30636987062d2f9}{numNodesVelocity\_}};}
\DoxyCodeLine{38     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a72e23e465ceb18a0dfcd32d42b55aa82}{dofsElementPressure\_}}  = \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_abf1541abe26336013363cacacb149443}{dofsPressure\_}}*\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a37566d3b2a185a5b83277f811d4697ae}{numNodesPressure\_}};  }
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{//this-\/>solution\_ = vec\_dbl\_Type(dofsElementVelocity\_); //dofsElementPressure\_+}}
\DoxyCodeLine{41     this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_abc56761fd3df5841f8f906d0bdccee16}{solutionVelocity\_}} = vec\_dbl\_Type(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a5a962e0f07c7887831259dcce56b107c}{dofsElementVelocity\_}});}
\DoxyCodeLine{42     this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ab1e3da8b5d59c7a335906aa6415038ff}{solutionPressure\_}} = vec\_dbl\_Type(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a72e23e465ceb18a0dfcd32d42b55aa82}{dofsElementPressure\_}});}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_acbc4d361dd7fdb2f38bfa2dc78ec8d1f}{viscosity\_}} = this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_a1b7f9f820f3da30ff7dd8438ada14b3b}{params\_}}-\/>sublist(\textcolor{stringliteral}{"{}Parameter"{}}).get(\textcolor{stringliteral}{"{}Viscosity"{}},1.);}
\DoxyCodeLine{45     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ae9365558cbc37bb9fa3ba983a866b61f}{density\_}} = this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_a1b7f9f820f3da30ff7dd8438ada14b3b}{params\_}}-\/>sublist(\textcolor{stringliteral}{"{}Parameter"{}}).get(\textcolor{stringliteral}{"{}Density"{}},1.);}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a9856705f343a49ba159c64304ed020b4}{dofsElement\_}} = \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a5a962e0f07c7887831259dcce56b107c}{dofsElementVelocity\_}}+ \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a72e23e465ceb18a0dfcd32d42b55aa82}{dofsElementPressure\_}};}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}} coeff(2);}
\DoxyCodeLine{50     coeff[0][0]=1.; coeff[0][1] = 1.; coeff[1][0] = 1.; coeff[1][1] = 1.;}
\DoxyCodeLine{51     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a57d9297d4f690016abaf7736943a34d6}{coeff\_}} = coeff;}
\DoxyCodeLine{52 \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{55 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ad7fefe99558a5b3192ea7aad87ff3969}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::setCoeff}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}} coeff) \{}
\DoxyCodeLine{56     \textcolor{comment}{// We only substitute the coefficients if the matrix has the same }}
\DoxyCodeLine{57     \textcolor{comment}{// size. In some non timedepenent cases the coeff matrix can be empty. }}
\DoxyCodeLine{58     \textcolor{comment}{// We prevent that case.}}
\DoxyCodeLine{59     \textcolor{keywordflow}{if}(coeff.size() == 2)}
\DoxyCodeLine{60         coeff\_ = coeff;     }
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{65 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a1535786ac6b897da287e3e7e0aa60f61}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assembleJacobian}}() \{}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} elementMatrixN =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{68     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} elementMatrixW =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{keywordflow}{if}(this-\/>newtonStep\_ ==0)\{}
\DoxyCodeLine{71         \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} elementMatrixA =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{72         \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} elementMatrixB =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{73 }
\DoxyCodeLine{74         constantMatrix\_.reset(\textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         assemblyLaplacian(elementMatrixA);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         elementMatrixA-\/>scale(viscosity\_);}
\DoxyCodeLine{79         elementMatrixA-\/>scale(density\_);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81         constantMatrix\_-\/>add( (*elementMatrixA),(*constantMatrix\_));}
\DoxyCodeLine{82 }
\DoxyCodeLine{83         assemblyDivAndDivT(elementMatrixB);}
\DoxyCodeLine{84 }
\DoxyCodeLine{85         elementMatrixB-\/>scale(-\/1.);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87         constantMatrix\_-\/>add( (*elementMatrixB),(*constantMatrix\_));}
\DoxyCodeLine{88     \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     ANB\_.reset(\textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_)); \textcolor{comment}{// A + B + N}}
\DoxyCodeLine{91     ANB\_-\/>add( (*constantMatrix\_),(*ANB\_));}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     assemblyAdvection(elementMatrixN);}
\DoxyCodeLine{94     elementMatrixN-\/>scale(density\_);}
\DoxyCodeLine{95     ANB\_-\/>add( (*elementMatrixN),(*ANB\_));}
\DoxyCodeLine{96     assemblyAdvectionInU(elementMatrixW);}
\DoxyCodeLine{97     elementMatrixW-\/>scale(density\_);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99     \textcolor{comment}{//elementMatrix-\/>add((*constantMatrix\_),(*elementMatrix));}}
\DoxyCodeLine{100     this-\/>jacobian\_.reset(\textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     this-\/>jacobian\_-\/>add((*ANB\_),(*this-\/>jacobian\_));}
\DoxyCodeLine{103     this-\/>jacobian\_-\/>add((*elementMatrixW),(*this-\/>jacobian\_));  \textcolor{comment}{// int add(SmallMatrix<T> \&bMat, SmallMatrix<T> \&cMat); //this+B=C elementMatrix + constantMatrix\_;}}
\DoxyCodeLine{104 \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{107 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_ad66c0a9db00956e8df47d50d2e682403}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assemblyLaplacian}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} \&elementMatrix) \{}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     \textcolor{keywordtype}{int} dim = this-\/>getDim();}
\DoxyCodeLine{110     \textcolor{keywordtype}{int} numNodes= numNodesVelocity\_;}
\DoxyCodeLine{111     \textcolor{keywordtype}{int} Grad =2; \textcolor{comment}{// Needs to be fixed   }}
\DoxyCodeLine{112     \textcolor{keywordtype}{string} FEType = FETypeVelocity\_;}
\DoxyCodeLine{113     \textcolor{keywordtype}{int} dofs = dofsVelocity\_;}
\DoxyCodeLine{114 }
\DoxyCodeLine{115     vec3D\_dbl\_ptr\_Type  dPhi;}
\DoxyCodeLine{116     vec\_dbl\_ptr\_Type weights = Teuchos::rcp(\textcolor{keyword}{new} vec\_dbl\_Type(0));}
\DoxyCodeLine{117     }
\DoxyCodeLine{118     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} deg = \mbox{\hyperlink{classFEDD_1_1Helper_a62c020fe93bef461eb74528cb7f19511}{Helper::determineDegree}}(dim,FEType,Grad);}
\DoxyCodeLine{119     \mbox{\hyperlink{classFEDD_1_1Helper_aec6f9bc4208c7ce02f2bebad7a98e7d1}{Helper::getDPhi}}(dPhi, weights, dim, FEType, deg);}
\DoxyCodeLine{120     }
\DoxyCodeLine{121     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} detB;}
\DoxyCodeLine{122     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} absDetB;}
\DoxyCodeLine{123     SmallMatrix<SC> B(dim);}
\DoxyCodeLine{124     SmallMatrix<SC> Binv(dim);}
\DoxyCodeLine{125   }
\DoxyCodeLine{126     buildTransformation(B);}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     detB = B.computeInverse(Binv);}
\DoxyCodeLine{129     absDetB = std::fabs(detB);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     vec3D\_dbl\_Type dPhiTrans( dPhi-\/>size(), vec2D\_dbl\_Type( dPhi-\/>at(0).size(), vec\_dbl\_Type(dim,0.) ) );}
\DoxyCodeLine{132     applyBTinv( dPhi, dPhiTrans, Binv );}
\DoxyCodeLine{133     }
\DoxyCodeLine{134     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < numNodes; i++) \{}
\DoxyCodeLine{135         Teuchos::Array<SC> value( dPhiTrans[0].size(), 0. );}
\DoxyCodeLine{136         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < numNodes; j++) \{}
\DoxyCodeLine{137             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} w=0; w<dPhiTrans.size(); w++) \{}
\DoxyCodeLine{138                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dim; d++)\{}
\DoxyCodeLine{139                     value[j] += weights-\/>at(w) * dPhiTrans[w][i][d] * dPhiTrans[w][j][d];}
\DoxyCodeLine{140                 \}}
\DoxyCodeLine{141             \}}
\DoxyCodeLine{142             value[j] *= absDetB;}
\DoxyCodeLine{143              \textcolor{comment}{/*if (std::fabs(value[j]) < pow(10,-\/14)) \{}}
\DoxyCodeLine{144 \textcolor{comment}{                    value[j] = 0.;}}
\DoxyCodeLine{145 \textcolor{comment}{                \}*/}}
\DoxyCodeLine{146             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dofs; d++) \{}
\DoxyCodeLine{147               (*elementMatrix)[i*dofs +d][j*dofs+d] = value[j];}
\DoxyCodeLine{148             \}}
\DoxyCodeLine{149         \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151     \}}
\DoxyCodeLine{152 \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{155 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_af42c6437fdac694ffbdccd12f8c581f2}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assembleRHS}}()\{}
\DoxyCodeLine{156 }
\DoxyCodeLine{157     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} elementMatrixN =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_));}
\DoxyCodeLine{158 }
\DoxyCodeLine{159     ANB\_.reset(\textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a12c4d652d692956a7839abbf4c02b26a}{SmallMatrix\_Type}}( dofsElementVelocity\_+numNodesPressure\_)); \textcolor{comment}{// A + B + N}}
\DoxyCodeLine{160     ANB\_-\/>add( (*constantMatrix\_),(*ANB\_));}
\DoxyCodeLine{161 }
\DoxyCodeLine{162     assemblyAdvection(elementMatrixN);}
\DoxyCodeLine{163     elementMatrixN-\/>scale(density\_);}
\DoxyCodeLine{164     ANB\_-\/>add( (*elementMatrixN),(*ANB\_));}
\DoxyCodeLine{165 }
\DoxyCodeLine{166     this-\/>rhsVec\_ = vec\_dbl\_Type(dofsElement\_,0);}
\DoxyCodeLine{167     \textcolor{comment}{// Multiplying ANB\_ * solution}}
\DoxyCodeLine{168     \textcolor{keywordtype}{int} s=0,t=0;}
\DoxyCodeLine{169     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0 ; i< ANB\_-\/>size();i++)\{}
\DoxyCodeLine{170         \textcolor{keywordflow}{if} (i >= dofsElementVelocity\_)}
\DoxyCodeLine{171             s=1;}
\DoxyCodeLine{172         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j=0; j < ANB\_-\/>size(); j++)\{}
\DoxyCodeLine{173             \textcolor{keywordflow}{if}(j >= dofsElementVelocity\_)}
\DoxyCodeLine{174                 t=1;}
\DoxyCodeLine{175             this-\/>rhsVec\_[i] += (*ANB\_)[i][j]*this-\/>solution\_[j]*coeff\_[s][t];}
\DoxyCodeLine{176             \textcolor{comment}{//cout <<"{}Solution["{}<<j <<"{}]"{} << this-\/>solution\_[i] << endl;}}
\DoxyCodeLine{177         \}}
\DoxyCodeLine{178         t=0;}
\DoxyCodeLine{179         \textcolor{comment}{//cout <<"{}RHS["{}<<i <<"{}]"{} << this-\/>rhsVec\_[i] << endl;}}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{//this-\/>jacobian\_ = ANB\_; // int add(SmallMatrix<T> \&bMat, SmallMatrix<T> \&cMat); //this+B=C elementMatrix + constantMatrix\_;}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186 }
\DoxyCodeLine{187 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{188 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a29d454fb17d4f9a878471fedb3317f2d}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assemblyAdvection}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} \&elementMatrix)\{}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{keywordtype}{int} dim = this-\/>getDim();}
\DoxyCodeLine{191     \textcolor{keywordtype}{int} numNodes= numNodesVelocity\_;}
\DoxyCodeLine{192     \textcolor{keywordtype}{int} Grad =2; \textcolor{comment}{// Needs to be fixed   }}
\DoxyCodeLine{193     \textcolor{keywordtype}{string} FEType = FETypeVelocity\_;}
\DoxyCodeLine{194     \textcolor{keywordtype}{int} dofs = dofsVelocity\_;}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 }
\DoxyCodeLine{197     vec3D\_dbl\_ptr\_Type  dPhi;}
\DoxyCodeLine{198     vec2D\_dbl\_ptr\_Type  phi;}
\DoxyCodeLine{199     vec\_dbl\_ptr\_Type weights = Teuchos::rcp(\textcolor{keyword}{new} vec\_dbl\_Type(0));}
\DoxyCodeLine{200 }
\DoxyCodeLine{201     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} deg = 5; \textcolor{comment}{//Helper::determineDegree(dim,FEType,Grad); // Not complete}}
\DoxyCodeLine{202     \textcolor{comment}{//UN extraDeg = determineDegree( dim, FEType, Std); //Elementwise assembly of grad u}}
\DoxyCodeLine{203     \textcolor{comment}{//UN deg = determineDegree( dim, FEType, FEType, Grad, Std, extraDeg);}}
\DoxyCodeLine{204 }
\DoxyCodeLine{205     \mbox{\hyperlink{classFEDD_1_1Helper_aec6f9bc4208c7ce02f2bebad7a98e7d1}{Helper::getDPhi}}(dPhi, weights, dim, FEType, deg);}
\DoxyCodeLine{206     \mbox{\hyperlink{classFEDD_1_1Helper_ac15451b565dee93fa08b63c7a2957480}{Helper::getPhi}}(phi, weights, dim, FEType, deg);}
\DoxyCodeLine{207 }
\DoxyCodeLine{208     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} detB;}
\DoxyCodeLine{209     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} absDetB;}
\DoxyCodeLine{210     SmallMatrix<SC> B(dim);}
\DoxyCodeLine{211     SmallMatrix<SC> Binv(dim);}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     vec2D\_dbl\_Type uLoc( dim, vec\_dbl\_Type( weights-\/>size() , -\/1. ) );}
\DoxyCodeLine{214 }
\DoxyCodeLine{215     buildTransformation(B);}
\DoxyCodeLine{216     detB = B.computeInverse(Binv);}
\DoxyCodeLine{217     absDetB = std::fabs(detB);}
\DoxyCodeLine{218 }
\DoxyCodeLine{219     vec3D\_dbl\_Type dPhiTrans( dPhi-\/>size(), vec2D\_dbl\_Type( dPhi-\/>at(0).size(), vec\_dbl\_Type(dim,0.) ) );}
\DoxyCodeLine{220     applyBTinv( dPhi, dPhiTrans, Binv );}
\DoxyCodeLine{221 }
\DoxyCodeLine{222     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w=0; w<phi-\/>size(); w++)\{ \textcolor{comment}{//quads points}}
\DoxyCodeLine{223         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d=0; d<dim; d++) \{}
\DoxyCodeLine{224             uLoc[d][w] = 0.;}
\DoxyCodeLine{225             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i < phi-\/>at(0).size(); i++) \{}
\DoxyCodeLine{226                 \mbox{\hyperlink{fe__test__laplace_8cpp_ad6a38c9f07d3fd633eefca5bccad8410}{LO}} index = dim * i + d;}
\DoxyCodeLine{227                 uLoc[d][w] += this-\/>solution\_[index] * phi-\/>at(w).at(i);}
\DoxyCodeLine{228             \}}
\DoxyCodeLine{229         \}}
\DoxyCodeLine{230 }
\DoxyCodeLine{231     \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < phi-\/>at(0).size(); i++) \{}
\DoxyCodeLine{234         Teuchos::Array<SC> value( dPhiTrans[0].size(), 0. );}
\DoxyCodeLine{235         Teuchos::Array<GO> indices( dPhiTrans[0].size(), 0 );}
\DoxyCodeLine{236         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < value.size(); j++) \{}
\DoxyCodeLine{237             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} w=0; w<dPhiTrans.size(); w++) \{}
\DoxyCodeLine{238                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dim; d++)\{}
\DoxyCodeLine{239                     value[j] += weights-\/>at(w) * uLoc[d][w] * (*phi)[w][i] * dPhiTrans[w][j][d];}
\DoxyCodeLine{240                 \}}
\DoxyCodeLine{241             \}}
\DoxyCodeLine{242             value[j] *= absDetB;}
\DoxyCodeLine{243 }
\DoxyCodeLine{244             \textcolor{comment}{/*if (setZeros\_ \&\& std::fabs(value[j]) < myeps\_) \{}}
\DoxyCodeLine{245 \textcolor{comment}{                value[j] = 0.;}}
\DoxyCodeLine{246 \textcolor{comment}{            \}*/}}
\DoxyCodeLine{247 }
\DoxyCodeLine{248      }
\DoxyCodeLine{249         \}}
\DoxyCodeLine{250         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dim; d++) \{}
\DoxyCodeLine{251             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < indices.size(); j++)}
\DoxyCodeLine{252                  (*elementMatrix)[i*dofs +d][j*dofs+d] = value[j];}
\DoxyCodeLine{253             }
\DoxyCodeLine{254         \}}
\DoxyCodeLine{255         }
\DoxyCodeLine{256     \}}
\DoxyCodeLine{257 }
\DoxyCodeLine{258 \}}
\DoxyCodeLine{259 }
\DoxyCodeLine{260 }
\DoxyCodeLine{261 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{262 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a43e917f0b7509f8e95b0136af7876405}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assemblyAdvectionInU}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} \&elementMatrix)\{}
\DoxyCodeLine{263 }
\DoxyCodeLine{264     \textcolor{keywordtype}{int} dim = this-\/>getDim();}
\DoxyCodeLine{265     \textcolor{keywordtype}{int} numNodes= numNodesVelocity\_;}
\DoxyCodeLine{266     \textcolor{keywordtype}{int} Grad =2; \textcolor{comment}{// Needs to be fixed   }}
\DoxyCodeLine{267     \textcolor{keywordtype}{string} FEType = FETypeVelocity\_;}
\DoxyCodeLine{268     \textcolor{keywordtype}{int} dofs = dofsVelocity\_;}
\DoxyCodeLine{269 }
\DoxyCodeLine{270 }
\DoxyCodeLine{271     vec3D\_dbl\_ptr\_Type  dPhi;}
\DoxyCodeLine{272     vec2D\_dbl\_ptr\_Type  phi;}
\DoxyCodeLine{273     vec\_dbl\_ptr\_Type weights = Teuchos::rcp(\textcolor{keyword}{new} vec\_dbl\_Type(0));}
\DoxyCodeLine{274 }
\DoxyCodeLine{275     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} deg = 5 ;\textcolor{comment}{// Helper::determineDegree(dim,FEType,Grad); // Not complete}}
\DoxyCodeLine{276     \textcolor{comment}{//UN extraDeg = determineDegree( dim, FEType, Std); //Elementwise assembly of grad u}}
\DoxyCodeLine{277     \textcolor{comment}{//UN deg = determineDegree( dim, FEType, FEType, Grad, Std, extraDeg);}}
\DoxyCodeLine{278 }
\DoxyCodeLine{279     \mbox{\hyperlink{classFEDD_1_1Helper_aec6f9bc4208c7ce02f2bebad7a98e7d1}{Helper::getDPhi}}(dPhi, weights, dim, FEType, deg);}
\DoxyCodeLine{280     \mbox{\hyperlink{classFEDD_1_1Helper_ac15451b565dee93fa08b63c7a2957480}{Helper::getPhi}}(phi, weights, dim, FEType, deg);}
\DoxyCodeLine{281 }
\DoxyCodeLine{282     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} detB;}
\DoxyCodeLine{283     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} absDetB;}
\DoxyCodeLine{284     SmallMatrix<SC> B(dim);}
\DoxyCodeLine{285     SmallMatrix<SC> Binv(dim);}
\DoxyCodeLine{286 }
\DoxyCodeLine{287     vec2D\_dbl\_Type uLoc( dim, vec\_dbl\_Type( weights-\/>size() , -\/1. ) );}
\DoxyCodeLine{288 }
\DoxyCodeLine{289     buildTransformation(B);}
\DoxyCodeLine{290     detB = B.computeInverse(Binv);}
\DoxyCodeLine{291     absDetB = std::fabs(detB);}
\DoxyCodeLine{292 }
\DoxyCodeLine{293     vec3D\_dbl\_Type dPhiTrans( dPhi-\/>size(), vec2D\_dbl\_Type( dPhi-\/>at(0).size(), vec\_dbl\_Type(dim,0.) ) );}
\DoxyCodeLine{294     applyBTinv( dPhi, dPhiTrans, Binv );}
\DoxyCodeLine{295     \textcolor{comment}{//UN FEloc = checkFE(dim,FEType);}}
\DoxyCodeLine{296 }
\DoxyCodeLine{297 }
\DoxyCodeLine{298     std::vector<SmallMatrix<SC> > duLoc( weights-\/>size(), SmallMatrix<SC>(dim) ); \textcolor{comment}{//for all quad points p\_i each matrix is [u\_x * grad Phi(p\_i), u\_y * grad Phi(p\_i), u\_z * grad Phi(p\_i) (if 3D) ], duLoc[w] = [[phixx;phixy],[phiyx;phiyy]] (2D)}}
\DoxyCodeLine{299 }
\DoxyCodeLine{300     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w=0; w<dPhiTrans.size(); w++)\{ \textcolor{comment}{//quads points}}
\DoxyCodeLine{301         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d1=0; d1<dim; d1++) \{}
\DoxyCodeLine{302             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i < dPhiTrans[0].size(); i++) \{}
\DoxyCodeLine{303                 \mbox{\hyperlink{fe__test__laplace_8cpp_ad6a38c9f07d3fd633eefca5bccad8410}{LO}} index = dim *i+ d1;}
\DoxyCodeLine{304                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d2=0; d2<dim; d2++)}
\DoxyCodeLine{305                     duLoc[w][d2][d1] += this-\/>solution\_[index] * dPhiTrans[w][i][d2];}
\DoxyCodeLine{306             \}}
\DoxyCodeLine{307         \}}
\DoxyCodeLine{308     \}}
\DoxyCodeLine{309 }
\DoxyCodeLine{310     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < phi-\/>at(0).size(); i++) \{}
\DoxyCodeLine{311         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d1=0; d1<dim; d1++) \{}
\DoxyCodeLine{312             Teuchos::Array<SC> value( dim*phi-\/>at(0).size(), 0. ); \textcolor{comment}{//These are value (W\_ix,W\_iy,W\_iz)}}
\DoxyCodeLine{313             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < phi-\/>at(0).size(); j++) \{}
\DoxyCodeLine{314                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d2=0; d2<dim; d2++)\{}
\DoxyCodeLine{315                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} w=0; w<phi-\/>size(); w++) \{}
\DoxyCodeLine{316                         value[ dim * j + d2 ] += weights-\/>at(w) * duLoc[w][d2][d1] * (*phi)[w][i] * (*phi)[w][j];}
\DoxyCodeLine{317                     \}}
\DoxyCodeLine{318                     value[ dim * j + d2 ] *= absDetB;}
\DoxyCodeLine{319                 \}}
\DoxyCodeLine{320             \}}
\DoxyCodeLine{321             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < phi-\/>at(0).size(); j++)\{}
\DoxyCodeLine{322                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dofs; d++) \{}
\DoxyCodeLine{323                     (*elementMatrix)[i*dofs +d1][j*dofs+d] = value[j*dofs+d];}
\DoxyCodeLine{324                 \}}
\DoxyCodeLine{325             \}}
\DoxyCodeLine{326           }
\DoxyCodeLine{327         \}}
\DoxyCodeLine{328     \}}
\DoxyCodeLine{329 \}}
\DoxyCodeLine{330  }
\DoxyCodeLine{331 }
\DoxyCodeLine{332 }
\DoxyCodeLine{333 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{334 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_afec8907a0c90e42b5d0ceeb2509f3b31}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::assemblyDivAndDivT}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a327b281cceb65293a78e87c0c39facc7}{SmallMatrixPtr\_Type}} \&elementMatrix) \{}
\DoxyCodeLine{335 }
\DoxyCodeLine{336     vec3D\_dbl\_ptr\_Type  dPhi;}
\DoxyCodeLine{337     vec2D\_dbl\_ptr\_Type  phi;}
\DoxyCodeLine{338     vec\_dbl\_ptr\_Type weights = Teuchos::rcp(\textcolor{keyword}{new} vec\_dbl\_Type(0));}
\DoxyCodeLine{339     \textcolor{keywordtype}{int} dim = this-\/>dim\_;}
\DoxyCodeLine{340 }
\DoxyCodeLine{341     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} deg =2; \textcolor{comment}{// Helper::determineDegree2( dim, FETypeVelocity\_, FETypePressure\_, Grad, Std);}}
\DoxyCodeLine{342 }
\DoxyCodeLine{343     \mbox{\hyperlink{classFEDD_1_1Helper_aec6f9bc4208c7ce02f2bebad7a98e7d1}{Helper::getDPhi}}(dPhi, weights, dim, FETypeVelocity\_, deg);}
\DoxyCodeLine{344 }
\DoxyCodeLine{345     \textcolor{comment}{//if (FETypePressure\_=="{}P1-\/disc-\/global"{})}}
\DoxyCodeLine{346       \textcolor{comment}{//  Helper::getPhiGlobal(phi, weights, dim, FETypePressure\_, deg);}}
\DoxyCodeLine{347     \textcolor{keywordflow}{if} (FETypePressure\_==\textcolor{stringliteral}{"{}P1-\/disc"{}} \&\& FETypeVelocity\_==\textcolor{stringliteral}{"{}Q2"{}} )}
\DoxyCodeLine{348         \mbox{\hyperlink{classFEDD_1_1Helper_ac15451b565dee93fa08b63c7a2957480}{Helper::getPhi}}(phi, weights, dim, FETypePressure\_, deg, FETypeVelocity\_);}
\DoxyCodeLine{349     \textcolor{keywordflow}{else}}
\DoxyCodeLine{350         \mbox{\hyperlink{classFEDD_1_1Helper_ac15451b565dee93fa08b63c7a2957480}{Helper::getPhi}}(phi, weights, dim, FETypePressure\_, deg);}
\DoxyCodeLine{351 }
\DoxyCodeLine{352     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} detB;}
\DoxyCodeLine{353     \mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}} absDetB;}
\DoxyCodeLine{354     SmallMatrix<SC> B(dim);}
\DoxyCodeLine{355     SmallMatrix<SC> Binv(dim);}
\DoxyCodeLine{356 }
\DoxyCodeLine{357 }
\DoxyCodeLine{358     buildTransformation(B);}
\DoxyCodeLine{359     detB = B.computeInverse(Binv);}
\DoxyCodeLine{360     absDetB = std::fabs(detB);}
\DoxyCodeLine{361 }
\DoxyCodeLine{362     vec3D\_dbl\_Type dPhiTrans( dPhi-\/>size(), vec2D\_dbl\_Type( dPhi-\/>at(0).size(), vec\_dbl\_Type(dim,0.) ) );}
\DoxyCodeLine{363     applyBTinv( dPhi, dPhiTrans, Binv );}
\DoxyCodeLine{364 }
\DoxyCodeLine{365     Teuchos::Array<GO> rowIndex( 1, 0 );}
\DoxyCodeLine{366     Teuchos::Array<SC> value(1, 0.);}
\DoxyCodeLine{367 }
\DoxyCodeLine{368 }
\DoxyCodeLine{369     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < phi-\/>at(0).size(); i++) \{}
\DoxyCodeLine{370         \textcolor{keywordflow}{if} (FETypePressure\_==\textcolor{stringliteral}{"{}P0"{}})}
\DoxyCodeLine{371             rowIndex[0] = \mbox{\hyperlink{fe__test__laplace_8cpp_afa2946b509009b4f45eb04bd8c5b27d9}{GO}} ( 0 );}
\DoxyCodeLine{372         \textcolor{keywordflow}{else}}
\DoxyCodeLine{373             rowIndex[0] = \mbox{\hyperlink{fe__test__laplace_8cpp_afa2946b509009b4f45eb04bd8c5b27d9}{GO}} ( i );}
\DoxyCodeLine{374 }
\DoxyCodeLine{375         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < dPhiTrans[0].size(); j++) \{}
\DoxyCodeLine{376             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d=0; d<dim; d++)\{}
\DoxyCodeLine{377                 value[0] = 0.;}
\DoxyCodeLine{378                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} w=0; w<dPhiTrans.size(); w++)}
\DoxyCodeLine{379                     value[0] += weights-\/>at(w) * phi-\/>at(w)[i] * dPhiTrans[w][j][d];}
\DoxyCodeLine{380                 value[0] *= absDetB;}
\DoxyCodeLine{381 }
\DoxyCodeLine{382 }
\DoxyCodeLine{383                 (*elementMatrix)[rowIndex[0]+dofsVelocity\_*numNodesVelocity\_][dofsVelocity\_ * j + d] +=value[0];}
\DoxyCodeLine{384                 (*elementMatrix)[dofsVelocity\_ * j + d][dofsVelocity\_*numNodesVelocity\_+rowIndex[0]] +=value[0];}
\DoxyCodeLine{385             \}}
\DoxyCodeLine{386         \}}
\DoxyCodeLine{387     \}}
\DoxyCodeLine{388     \textcolor{comment}{//elementMatrix-\/>print();}}
\DoxyCodeLine{389     \textcolor{comment}{// We compute value twice, maybe we should change this}}
\DoxyCodeLine{390     \textcolor{comment}{/*for (UN i=0; i < dPhiTrans[0].size(); i++) \{}}
\DoxyCodeLine{391 \textcolor{comment}{}}
\DoxyCodeLine{392 \textcolor{comment}{        Teuchos::Array<Teuchos::Array<SC> >valueVec( dim, Teuchos::Array<SC>( phi-\/>at(0).size(), 0. ) );}}
\DoxyCodeLine{393 \textcolor{comment}{        Teuchos::Array<GO> indices( phi-\/>at(0).size(), 0 );}}
\DoxyCodeLine{394 \textcolor{comment}{        for (UN j=0; j < valueVec[0].size(); j++) \{}}
\DoxyCodeLine{395 \textcolor{comment}{            for (UN w=0; w<dPhiTrans.size(); w++) \{}}
\DoxyCodeLine{396 \textcolor{comment}{                for (UN d=0; d<dim; d++)}}
\DoxyCodeLine{397 \textcolor{comment}{                    valueVec[d][j] += weights-\/>at(w) * phi-\/>at(w)[j] * dPhiTrans[w][i][d];}}
\DoxyCodeLine{398 \textcolor{comment}{            \}}}
\DoxyCodeLine{399 \textcolor{comment}{            for (UN d=0; d<dim; d++)\{}}
\DoxyCodeLine{400 \textcolor{comment}{                valueVec[d][j] *= absDetB;}}
\DoxyCodeLine{401 \textcolor{comment}{                if (setZeros\_ \&\& std::fabs(valueVec[d][j]) < myeps\_) \{}}
\DoxyCodeLine{402 \textcolor{comment}{                    valueVec[d][j] = 0.;}}
\DoxyCodeLine{403 \textcolor{comment}{                \}}}
\DoxyCodeLine{404 \textcolor{comment}{            \}}}
\DoxyCodeLine{405 \textcolor{comment}{        \}}}
\DoxyCodeLine{406 \textcolor{comment}{}}
\DoxyCodeLine{407 \textcolor{comment}{        for (UN j=0; j < indices.size(); j++)\{}}
\DoxyCodeLine{408 \textcolor{comment}{            if (FEType2=="{}P0"{})}}
\DoxyCodeLine{409 \textcolor{comment}{                indices[j] = GO ( mapping2-\/>getGlobalElement( T ) );}}
\DoxyCodeLine{410 \textcolor{comment}{            else}}
\DoxyCodeLine{411 \textcolor{comment}{                indices[j] = GO ( mapping2-\/>getGlobalElement( elements2-\/>getElement(T).getNode(j) ) );}}
\DoxyCodeLine{412 \textcolor{comment}{        \}}}
\DoxyCodeLine{413 \textcolor{comment}{        for (UN d=0; d<dim; d++) \{}}
\DoxyCodeLine{414 \textcolor{comment}{            GO row = GO ( dim * mapping1-\/>getGlobalElement( elements1-\/>getElement(T).getNode(i) ) + d );}}
\DoxyCodeLine{415 \textcolor{comment}{            BTmat-\/>insertGlobalValues( row, indices(), valueVec[d]() );}}
\DoxyCodeLine{416 \textcolor{comment}{        \}}}
\DoxyCodeLine{417 \textcolor{comment}{}}
\DoxyCodeLine{418 \textcolor{comment}{    \}*/}}
\DoxyCodeLine{419 }
\DoxyCodeLine{420 }
\DoxyCodeLine{421 \}}
\DoxyCodeLine{422 }
\DoxyCodeLine{423 }
\DoxyCodeLine{432 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{433 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a53800a9619bf9e254f1fb4bd38f1a4af}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::buildTransformation}}(SmallMatrix<SC>\& B)\{}
\DoxyCodeLine{434 }
\DoxyCodeLine{435     TEUCHOS\_TEST\_FOR\_EXCEPTION( (B.size()<2 || B.size()>3), std::logic\_error, \textcolor{stringliteral}{"{}Initialize SmallMatrix for transformation."{}});}
\DoxyCodeLine{436     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} index;}
\DoxyCodeLine{437     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} index0 = 0;}
\DoxyCodeLine{438     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j<B.size(); j++) \{}
\DoxyCodeLine{439         index = j+1;}
\DoxyCodeLine{440         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i<B.size(); i++) \{}
\DoxyCodeLine{441             B[i][j] = this-\/>nodesRefConfig\_.at(index).at(i) -\/ this-\/>nodesRefConfig\_.at(index0).at(i);}
\DoxyCodeLine{442         \}}
\DoxyCodeLine{443     \}}
\DoxyCodeLine{444 }
\DoxyCodeLine{445 \}}
\DoxyCodeLine{446 }
\DoxyCodeLine{447 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{448 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNavierStokes_a21245b4e7d008c8f1cc28e6dad2873c1}{AssembleFEAceNavierStokes<SC,LO,GO,NO>::applyBTinv}}( vec3D\_dbl\_ptr\_Type\& dPhiIn,}
\DoxyCodeLine{449                                     vec3D\_dbl\_Type\& dPhiOut,}
\DoxyCodeLine{450                                     SmallMatrix<SC>\& Binv)\{}
\DoxyCodeLine{451     \mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} dim = Binv.size();}
\DoxyCodeLine{452     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} w=0; w<dPhiIn-\/>size(); w++)\{}
\DoxyCodeLine{453         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < dPhiIn-\/>at(w).size(); i++) \{}
\DoxyCodeLine{454             \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d1=0; d1<dim; d1++) \{}
\DoxyCodeLine{455                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} d2=0; d2<dim; d2++) \{}
\DoxyCodeLine{456                     dPhiOut[w][i][d1] += dPhiIn-\/>at(w).at(i).at(d2) * Binv[d2][d1];}
\DoxyCodeLine{457                 \}}
\DoxyCodeLine{458             \}}
\DoxyCodeLine{459         \}}
\DoxyCodeLine{460     \}}
\DoxyCodeLine{461 \}}
\DoxyCodeLine{462 }
\DoxyCodeLine{463 \}}
\DoxyCodeLine{464 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{465 }

\end{DoxyCode}
