\hypertarget{AssembleFEAceNonLinElas__def_8hpp_source}{}\doxysection{Assemble\+FEAce\+Non\+Lin\+Elas\+\_\+def.\+hpp}
\label{AssembleFEAceNonLinElas__def_8hpp_source}\index{specific/AssembleFEAceNonLinElas\_def.hpp@{specific/AssembleFEAceNonLinElas\_def.hpp}}
\mbox{\hyperlink{AssembleFEAceNonLinElas__def_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef ASSEMBLEFEACENONLINELAS\_DEF\_hpp}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define ASSEMBLEFEACENONLINELAS\_DEF\_hpp}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{AssembleFEAceNonLinElas__decl_8hpp}{AssembleFEAceNonLinElas\_decl.hpp}}"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{NeoHookQuadraticTets2_8hpp}{feddlib/core/AceFemAssembly/AceInterface/NeoHookQuadraticTets2.hpp}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceFEDD}{FEDD}} \{}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 }
\DoxyCodeLine{22 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{23 \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a9f4611ca66096b15e5450a51e03b72f0}{AssembleFEAceNonLinElas<SC,LO,GO,NO>::AssembleFEAceNonLinElas}}(\textcolor{keywordtype}{int} flag, vec2D\_dbl\_Type nodesRefConfig, ParameterListPtr\_Type params,tuple\_disk\_vec\_ptr\_Type tuple):}
\DoxyCodeLine{24 \mbox{\hyperlink{classFEDD_1_1AssembleFE}{AssembleFE}}<\mbox{\hyperlink{fe__test__laplace_8cpp_a79c7e86a57edbb2a5a53242bcd04e41e}{SC}},\mbox{\hyperlink{fe__test__laplace_8cpp_ad6a38c9f07d3fd633eefca5bccad8410}{LO}},\mbox{\hyperlink{fe__test__laplace_8cpp_afa2946b509009b4f45eb04bd8c5b27d9}{GO}},\mbox{\hyperlink{fe__test__laplace_8cpp_a5e24f37b28787429872b6ecb1d0417ce}{NO}}>(flag, nodesRefConfig, params,tuple)}
\DoxyCodeLine{25 \{}
\DoxyCodeLine{27     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_afd6c0ecd7cef3f6d411ad638905e6e6b}{E\_}} = this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_a1b7f9f820f3da30ff7dd8438ada14b3b}{params\_}}-\/>sublist(\textcolor{stringliteral}{"{}Parameter"{}}).get(\textcolor{stringliteral}{"{}E"{}},3500.0); \textcolor{comment}{// the last value is the dafault value, in case no parameter is set}}
\DoxyCodeLine{28     \textcolor{comment}{//lambda\_ = this-\/>params\_-\/>sublist("{}Parameter"{}).get("{}lambda"{},1.);}}
\DoxyCodeLine{29     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a8423dd70949ef95dbbcbd8d813c5dcae}{poissonRatio\_}} = this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_a1b7f9f820f3da30ff7dd8438ada14b3b}{params\_}}-\/>sublist(\textcolor{stringliteral}{"{}Parameter"{}}).get(\textcolor{stringliteral}{"{}Poisson Ratio"{}},0.4e-\/0);}
\DoxyCodeLine{30 }
\DoxyCodeLine{33     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a4e8bd1237ddf26bf1f0a38de37b31717}{FEType\_}} = std::get<1>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(0)); \textcolor{comment}{// FEType of Disk}}
\DoxyCodeLine{34     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a40837e4918146140582c5256feee2adb}{dofs\_}} = std::get<2>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(0)); \textcolor{comment}{// Degrees of freedom per node}}
\DoxyCodeLine{35     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a875b5dfdc5720f4e0da604386fd3ac6c}{numNodes\_}} = std::get<3>(this-\/>\mbox{\hyperlink{classFEDD_1_1AssembleFE_afd156e8e0ad2ca015a604290919d5794}{diskTuple\_}}-\/>at(0)); \textcolor{comment}{// Number of nodes of element}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a5d8b1f3ac087e577c422574dad22b04e}{dofsElement\_}} = \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a40837e4918146140582c5256feee2adb}{dofs\_}}*\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a875b5dfdc5720f4e0da604386fd3ac6c}{numNodes\_}}; \textcolor{comment}{// "{}Dimension of return matrix"{}}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{49 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{50 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a6770e1ebdb193d12969a757a5fb7e17b}{AssembleFEAceNonLinElas<SC,LO,GO,NO>::assembleJacobian}}() \{}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_abd9f58f78340f41c01deff6e6dbc2776}{SmallMatrixPtr\_Type}} elementMatrix =Teuchos::rcp( \textcolor{keyword}{new} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_ac63850ac099db321e886bfacc8fdb06e}{SmallMatrix\_Type}}( dofsElement\_)); \textcolor{comment}{// Matrix we fill with entries.}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     assemblyNonLinElas(elementMatrix); \textcolor{comment}{// Function that fills the matrix. We pass though a pointer that will be filled.}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     this-\/>jacobian\_ = elementMatrix ; \textcolor{comment}{// We init the jacobian matrix with the matrix we just build.}}
\DoxyCodeLine{58 \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{67 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{68 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_ab2007a5e14dc1d150b1be696dc35fc82}{AssembleFEAceNonLinElas<SC,LO,GO,NO>::assemblyNonLinElas}}(\mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_abd9f58f78340f41c01deff6e6dbc2776}{SmallMatrixPtr\_Type}} \&elementMatrix) \{}
\DoxyCodeLine{69 }
\DoxyCodeLine{71     \textcolor{comment}{// dofs\_}}
\DoxyCodeLine{72     \textcolor{comment}{// FEType\_}}
\DoxyCodeLine{73     \textcolor{comment}{// numNodes\_}}
\DoxyCodeLine{74     \textcolor{comment}{// dofsElement\_}}
\DoxyCodeLine{75     \textcolor{comment}{// mu\_}}
\DoxyCodeLine{76     \textcolor{comment}{// poissonRatio\_}}
\DoxyCodeLine{77 }
\DoxyCodeLine{80     }
\DoxyCodeLine{81     std::vector<double> v(1002); \textcolor{comment}{//Working vector, size defined by AceGen-\/FEAP}}
\DoxyCodeLine{82     std::vector<double> d(2); \textcolor{comment}{// Material parameters}}
\DoxyCodeLine{83     std::vector<double> ul(30); \textcolor{comment}{// The solution vector(or displacement in this case)}}
\DoxyCodeLine{84     std::vector<double> ul0(30); \textcolor{comment}{// Currently unused but must be passed to match FEAP template}}
\DoxyCodeLine{85     std::vector<double> xl(30); \textcolor{comment}{// Nodal Positions in reference coordinates}}
\DoxyCodeLine{86     std::vector<double> s(900); \textcolor{comment}{// Element Stiffness Matrix [Output from skr]}}
\DoxyCodeLine{87     std::vector<double> p(30); \textcolor{comment}{// Residual vector [Output from skr]}}
\DoxyCodeLine{88     std::vector<double> ht(10); \textcolor{comment}{// History parameters currently unused}}
\DoxyCodeLine{89     std::vector<double> hp(10); \textcolor{comment}{// History parameters currently unused}}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     d[0] = this-\/>E\_; \textcolor{comment}{// TODO: Check order if there is a problem}}
\DoxyCodeLine{92     d[1] = this-\/>poissonRatio\_;}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<30;i++)}
\DoxyCodeLine{95         ul[i] = this-\/>getSolution()[i]; \textcolor{comment}{// What is the order? I need it in the form (u1,v1,w1,u2,v2,w2,...)}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{98     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<this-\/>numNodes\_;i++)}
\DoxyCodeLine{99         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j=0;j<this-\/>dofs\_;j++)\{}
\DoxyCodeLine{100             xl[count] = this-\/>getNodesRefConfig()[i][j];}
\DoxyCodeLine{101             count++;\}   }
\DoxyCodeLine{102 }
\DoxyCodeLine{103     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<s.size();i++)}
\DoxyCodeLine{104         s[i]=0.0;}
\DoxyCodeLine{105     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<p.size();i++)}
\DoxyCodeLine{106         p[i]=0.0;}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{comment}{// std::cout << "{}[DEBUG] SKR-\/Jacobian Calls after this line!"{} << std::endl;}}
\DoxyCodeLine{109     \mbox{\hyperlink{NeoHookQuadraticTets_8hpp_a0b63887d46bfaeb86951b19f0ad144cf}{skr}}(\&v[0],\&d[0],\&ul[0],\&ul0[0],\&xl[0],\&s[0],\&p[0],\&ht[0],\&hp[0]); \textcolor{comment}{// Fortran subroutine call modifies s and p}}
\DoxyCodeLine{110     \textcolor{comment}{// std::cout << "{}[DEBUG] SKR-\/Jacobian Call successful!"{} << std::endl;}}
\DoxyCodeLine{111     \textcolor{comment}{// Note: FEAP/Fortran returns matrices unrolled in column major form. This must be converted for use here.}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{comment}{/* std::cout << "{}[DEBUG] Printing FEAP output Stiffness vector"{} << std::endl;}}
\DoxyCodeLine{114 \textcolor{comment}{    for (int i=0;i<900;i++)}}
\DoxyCodeLine{115 \textcolor{comment}{        std::cout << s[i] << "{} "{};*/}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} i=0; i < this-\/>dofsElement\_; i++) \{}
\DoxyCodeLine{118         \textcolor{keywordflow}{for} (\mbox{\hyperlink{fe__test__laplace_8cpp_a223307b878979b01e3ac887d91865ab5}{UN}} j=0; j < this-\/>dofsElement\_; j++) \{}
\DoxyCodeLine{119             (*elementMatrix)[i][j] = -\/s[this-\/>dofsElement\_*j+i]; \textcolor{comment}{// Rolling into a matrix using column major (m*j+i)}}
\DoxyCodeLine{120         \}}
\DoxyCodeLine{121     \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \}}
\DoxyCodeLine{124 }
\DoxyCodeLine{131 \textcolor{keyword}{template} <\textcolor{keyword}{class} SC, \textcolor{keyword}{class} LO, \textcolor{keyword}{class} GO, \textcolor{keyword}{class} NO>}
\DoxyCodeLine{132 \textcolor{keywordtype}{void} \mbox{\hyperlink{classFEDD_1_1AssembleFEAceNonLinElas_a105680e674a7c37a59c50a9a16b8bcff}{AssembleFEAceNonLinElas<SC,LO,GO,NO>::assembleRHS}}() \{}
\DoxyCodeLine{133 }
\DoxyCodeLine{134     \textcolor{comment}{// [Efficiency] Need to know which is called first: assembleRHS() or assembleJacobian(), so that multiple calls to skr() may be avoided.}}
\DoxyCodeLine{135     \textcolor{comment}{// Note skr() computes both elementMatrix\_ and rhsVec\_}}
\DoxyCodeLine{136     std::vector<double> v(1002); \textcolor{comment}{//Working vector, size defined by AceGen-\/FEAP}}
\DoxyCodeLine{137     std::vector<double> d(2); \textcolor{comment}{// Material parameters}}
\DoxyCodeLine{138     std::vector<double> ul(30); \textcolor{comment}{// The solution vector(or displacement in this case)}}
\DoxyCodeLine{139     std::vector<double> ul0(30); \textcolor{comment}{// Currently unused but must be passed to match FEAP template}}
\DoxyCodeLine{140     std::vector<double> xl(30); \textcolor{comment}{// Nodal Positions in reference coordinates}}
\DoxyCodeLine{141     std::vector<double> s(900); \textcolor{comment}{// Element Stiffness Matrix [Output from skr]}}
\DoxyCodeLine{142     std::vector<double> p(30); \textcolor{comment}{// Residual vector [Output from skr]}}
\DoxyCodeLine{143     std::vector<double> ht(10); \textcolor{comment}{// History parameters currently unused}}
\DoxyCodeLine{144     std::vector<double> hp(10); \textcolor{comment}{// History parameters currently unused}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146     d[0] = this-\/>E\_; \textcolor{comment}{// TODO: Check order if there is a problem}}
\DoxyCodeLine{147     d[1] = this-\/>poissonRatio\_;}
\DoxyCodeLine{148 }
\DoxyCodeLine{149     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<30;i++)}
\DoxyCodeLine{150         ul[i] = this-\/>getSolution()[i];}
\DoxyCodeLine{151 }
\DoxyCodeLine{152     \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{153     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<this-\/>numNodes\_;i++)}
\DoxyCodeLine{154         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j=0;j<this-\/>dofs\_;j++)\{}
\DoxyCodeLine{155             xl[count] = this-\/>getNodesRefConfig()[i][j];}
\DoxyCodeLine{156             count++;\}}
\DoxyCodeLine{157 }
\DoxyCodeLine{158     \textcolor{comment}{// Initialize arrays to 0}}
\DoxyCodeLine{159     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<s.size();i++)}
\DoxyCodeLine{160         s[i]=0.0;}
\DoxyCodeLine{161     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0;i<p.size();i++)}
\DoxyCodeLine{162         p[i]=0.0;}
\DoxyCodeLine{163 }
\DoxyCodeLine{164     \textcolor{comment}{// std::cout << "{}[DEBUG] SKR-\/Rhs Calls after this line!"{} << std::endl;}}
\DoxyCodeLine{165     \mbox{\hyperlink{NeoHookQuadraticTets_8hpp_a0b63887d46bfaeb86951b19f0ad144cf}{skr}}(\&v[0],\&d[0],\&ul[0],\&ul0[0],\&xl[0],\&s[0],\&p[0],\&ht[0],\&hp[0]); \textcolor{comment}{// Fortran subroutine call modifies s and p}}
\DoxyCodeLine{166     \textcolor{comment}{// std::cout << "{}[DEBUG] SKR-\/Rhs Call successful!"{} << std::endl;}}
\DoxyCodeLine{167     this-\/>rhsVec\_ = p;}
\DoxyCodeLine{168 \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \}}
\DoxyCodeLine{171 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{172 }

\end{DoxyCode}
