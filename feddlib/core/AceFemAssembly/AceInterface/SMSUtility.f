      subroutine SMSIntPoints(icode,ngpo,gp)
      double precision gp(*)
      integer icode,ngpo
      double precision ic1(4),ic2(16),ic3(36),ic4(20),ic5(16),ic6(4),
     & ic7(32),ic8(108),ic9(256),ic10(36),ic11(32),ic12(4),ic13(12),
     & ic14(12),ic15(4),ic16(16),ic17(28),ic18(16),ic19(20),
     & ic20(4),ic21(8),ic22(12),ic23(16),ic24(20)

      data ic1/0d0,0d0
     &,0d0,4.00000000000000000d0
     &/
      data ic2/-0.577350269189625765d0,-0.577350269189625765d0
     &,0d0,1.00000000000000000d0
     &,0.577350269189625765d0,-0.577350269189625765d0
     &,0d0,1.00000000000000000d0
     &,-0.577350269189625765d0,0.577350269189625765d0
     &,0d0,1.00000000000000000d0
     &,0.577350269189625765d0,0.577350269189625765d0
     &,0d0,1.00000000000000000d0
     &/
      data ic3/-0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.308641975308641975d0
     &,0d0,-0.774596669241483377d0
     &,0d0,0.493827160493827160d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.308641975308641975d0
     &,-0.774596669241483377d0,0d0
     &,0d0,0.493827160493827160d0
     &,0d0,0d0
     &,0d0,0.790123456790123457d0
     &,0.774596669241483377d0,0d0
     &,0d0,0.493827160493827160d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.308641975308641975d0
     &,0d0,0.774596669241483377d0
     &,0d0,0.493827160493827160d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.308641975308641975d0
     &/
      data ic4/-0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.555555555555555556d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.555555555555555556d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.555555555555555556d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.555555555555555556d0
     &,0d0,0d0
     &,0d0,1.77777777777777778d0
     &/
      data ic5/-1.00000000000000000d0,-1.00000000000000000d0
     &,0d0,1.00000000000000000d0
     &,1.00000000000000000d0,-1.00000000000000000d0
     &,0d0,1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,0d0,1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,0d0,1.00000000000000000d0
     &/
      data ic6/0d0,0d0
     &,0d0,8.00000000000000000d0
     &/
      data ic7/-0.577350269189625765d0,-0.577350269189625765d0
     &,-0.577350269189625765d0,1.00000000000000000d0
     &,0.577350269189625765d0,-0.577350269189625765d0
     &,-0.577350269189625765d0,1.00000000000000000d0
     &,-0.577350269189625765d0,0.577350269189625765d0
     &,-0.577350269189625765d0,1.00000000000000000d0
     &,0.577350269189625765d0,0.577350269189625765d0
     &,-0.577350269189625765d0,1.00000000000000000d0
     &,-0.577350269189625765d0,-0.577350269189625765d0
     &,0.577350269189625765d0,1.00000000000000000d0
     &,0.577350269189625765d0,-0.577350269189625765d0
     &,0.577350269189625765d0,1.00000000000000000d0
     &,-0.577350269189625765d0,0.577350269189625765d0
     &,0.577350269189625765d0,1.00000000000000000d0
     &,0.577350269189625765d0,0.577350269189625765d0
     &,0.577350269189625765d0,1.00000000000000000d0
     &/
      data ic8/-0.774596669241483377d0,-0.774596669241483377d0
     &,-0.774596669241483377d0,0.171467764060356653d0
     &,0d0,-0.774596669241483377d0
     &,-0.774596669241483377d0,0.274348422496570645d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,-0.774596669241483377d0,0.171467764060356653d0
     &,-0.774596669241483377d0,0d0
     &,-0.774596669241483377d0,0.274348422496570645d0
     &,0d0,0d0
     &,-0.774596669241483377d0,0.438957475994513032d0
     &,0.774596669241483377d0,0d0
     &,-0.774596669241483377d0,0.274348422496570645d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,-0.774596669241483377d0,0.171467764060356653d0
     &,0d0,0.774596669241483377d0
     &,-0.774596669241483377d0,0.274348422496570645d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,-0.774596669241483377d0,0.171467764060356653d0
     &,-0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.274348422496570645d0
     &,0d0,-0.774596669241483377d0
     &,0d0,0.438957475994513032d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,0d0,0.274348422496570645d0
     &,-0.774596669241483377d0,0d0
     &,0d0,0.438957475994513032d0
     &,0d0,0d0
     &,0d0,0.702331961591220850d0
     &,0.774596669241483377d0,0d0
     &,0d0,0.438957475994513032d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.274348422496570645d0
     &,0d0,0.774596669241483377d0
     &,0d0,0.438957475994513032d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,0d0,0.274348422496570645d0
     &,-0.774596669241483377d0,-0.774596669241483377d0
     &,0.774596669241483377d0,0.171467764060356653d0
     &,0d0,-0.774596669241483377d0
     &,0.774596669241483377d0,0.274348422496570645d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,0.774596669241483377d0,0.171467764060356653d0
     &,-0.774596669241483377d0,0d0
     &,0.774596669241483377d0,0.274348422496570645d0
     &,0d0,0d0
     &,0.774596669241483377d0,0.438957475994513032d0
     &,0.774596669241483377d0,0d0
     &,0.774596669241483377d0,0.274348422496570645d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,0.774596669241483377d0,0.171467764060356653d0
     &,0d0,0.774596669241483377d0
     &,0.774596669241483377d0,0.274348422496570645d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,0.774596669241483377d0,0.171467764060356653d0
     &/
      data ic9/-0.861136311594052575d0,-0.861136311594052575d0
     &,-0.861136311594052575d0,0.0420914774905314545d0
     &,-0.339981043584856265d0,-0.861136311594052575d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,0.339981043584856265d0,-0.861136311594052575d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,0.861136311594052575d0,-0.861136311594052575d0
     &,-0.861136311594052575d0,0.0420914774905314545d0
     &,-0.861136311594052575d0,-0.339981043584856265d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,-0.339981043584856265d0
     &,-0.861136311594052575d0,0.147940336056781301d0
     &,0.339981043584856265d0,-0.339981043584856265d0
     &,-0.861136311594052575d0,0.147940336056781301d0
     &,0.861136311594052575d0,-0.339981043584856265d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,0.339981043584856265d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,0.339981043584856265d0
     &,-0.861136311594052575d0,0.147940336056781301d0
     &,0.339981043584856265d0,0.339981043584856265d0
     &,-0.861136311594052575d0,0.147940336056781301d0
     &,0.861136311594052575d0,0.339981043584856265d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,0.861136311594052575d0
     &,-0.861136311594052575d0,0.0420914774905314545d0
     &,-0.339981043584856265d0,0.861136311594052575d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,0.339981043584856265d0,0.861136311594052575d0
     &,-0.861136311594052575d0,0.0789115157950705510d0
     &,0.861136311594052575d0,0.861136311594052575d0
     &,-0.861136311594052575d0,0.0420914774905314545d0
     &,-0.861136311594052575d0,-0.861136311594052575d0
     &,-0.339981043584856265d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,-0.861136311594052575d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,0.339981043584856265d0,-0.861136311594052575d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,0.861136311594052575d0,-0.861136311594052575d0
     &,-0.339981043584856265d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,-0.339981043584856265d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,-0.339981043584856265d0,-0.339981043584856265d0
     &,-0.339981043584856265d0,0.277352966953912990d0
     &,0.339981043584856265d0,-0.339981043584856265d0
     &,-0.339981043584856265d0,0.277352966953912990d0
     &,0.861136311594052575d0,-0.339981043584856265d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,-0.861136311594052575d0,0.339981043584856265d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,-0.339981043584856265d0,0.339981043584856265d0
     &,-0.339981043584856265d0,0.277352966953912990d0
     &,0.339981043584856265d0,0.339981043584856265d0
     &,-0.339981043584856265d0,0.277352966953912990d0
     &,0.861136311594052575d0,0.339981043584856265d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,-0.861136311594052575d0,0.861136311594052575d0
     &,-0.339981043584856265d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,0.861136311594052575d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,0.339981043584856265d0,0.861136311594052575d0
     &,-0.339981043584856265d0,0.147940336056781301d0
     &,0.861136311594052575d0,0.861136311594052575d0
     &,-0.339981043584856265d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,-0.861136311594052575d0
     &,0.339981043584856265d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,-0.861136311594052575d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,0.339981043584856265d0,-0.861136311594052575d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,0.861136311594052575d0,-0.861136311594052575d0
     &,0.339981043584856265d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,-0.339981043584856265d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,-0.339981043584856265d0,-0.339981043584856265d0
     &,0.339981043584856265d0,0.277352966953912990d0
     &,0.339981043584856265d0,-0.339981043584856265d0
     &,0.339981043584856265d0,0.277352966953912990d0
     &,0.861136311594052575d0,-0.339981043584856265d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,-0.861136311594052575d0,0.339981043584856265d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,-0.339981043584856265d0,0.339981043584856265d0
     &,0.339981043584856265d0,0.277352966953912990d0
     &,0.339981043584856265d0,0.339981043584856265d0
     &,0.339981043584856265d0,0.277352966953912990d0
     &,0.861136311594052575d0,0.339981043584856265d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,-0.861136311594052575d0,0.861136311594052575d0
     &,0.339981043584856265d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,0.861136311594052575d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,0.339981043584856265d0,0.861136311594052575d0
     &,0.339981043584856265d0,0.147940336056781301d0
     &,0.861136311594052575d0,0.861136311594052575d0
     &,0.339981043584856265d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,-0.861136311594052575d0
     &,0.861136311594052575d0,0.0420914774905314545d0
     &,-0.339981043584856265d0,-0.861136311594052575d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,0.339981043584856265d0,-0.861136311594052575d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,0.861136311594052575d0,-0.861136311594052575d0
     &,0.861136311594052575d0,0.0420914774905314545d0
     &,-0.861136311594052575d0,-0.339981043584856265d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,-0.339981043584856265d0
     &,0.861136311594052575d0,0.147940336056781301d0
     &,0.339981043584856265d0,-0.339981043584856265d0
     &,0.861136311594052575d0,0.147940336056781301d0
     &,0.861136311594052575d0,-0.339981043584856265d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,0.339981043584856265d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,-0.339981043584856265d0,0.339981043584856265d0
     &,0.861136311594052575d0,0.147940336056781301d0
     &,0.339981043584856265d0,0.339981043584856265d0
     &,0.861136311594052575d0,0.147940336056781301d0
     &,0.861136311594052575d0,0.339981043584856265d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,-0.861136311594052575d0,0.861136311594052575d0
     &,0.861136311594052575d0,0.0420914774905314545d0
     &,-0.339981043584856265d0,0.861136311594052575d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,0.339981043584856265d0,0.861136311594052575d0
     &,0.861136311594052575d0,0.0789115157950705510d0
     &,0.861136311594052575d0,0.861136311594052575d0
     &,0.861136311594052575d0,0.0420914774905314545d0
     &/
      data ic10/-0.774596669241483377d0,-0.774596669241483377d0
     &,-0.774596669241483377d0,0.555555555555555556d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,-0.774596669241483377d0,0.555555555555555556d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,-0.774596669241483377d0,0.555555555555555556d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,-0.774596669241483377d0,0.555555555555555556d0
     &,-0.774596669241483377d0,-0.774596669241483377d0
     &,0.774596669241483377d0,0.555555555555555556d0
     &,0.774596669241483377d0,-0.774596669241483377d0
     &,0.774596669241483377d0,0.555555555555555556d0
     &,-0.774596669241483377d0,0.774596669241483377d0
     &,0.774596669241483377d0,0.555555555555555556d0
     &,0.774596669241483377d0,0.774596669241483377d0
     &,0.774596669241483377d0,0.555555555555555556d0
     &,0d0,0d0
     &,0d0,3.55555555555555556d0
     &/
      data ic11/-1.00000000000000000d0,-1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,-1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,-1.00000000000000000d0,-1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,-1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,-1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &,1.00000000000000000d0,1.00000000000000000d0
     &/
      data ic12/0.333333333333333333d0,0.333333333333333333d0
     &,0d0,0.500000000000000000d0
     &/
      data ic13/0d0,0d0
     &,0d0,0.166666666666666667d0
     &,1.00000000000000000d0,0d0
     &,0d0,0.166666666666666667d0
     &,0d0,1.00000000000000000d0
     &,0d0,0.166666666666666667d0
     &/
      data ic14/0.500000000000000000d0,0.500000000000000000d0
     &,0d0,0.166666666666666667d0
     &,0d0,0.500000000000000000d0
     &,0d0,0.166666666666666667d0
     &,0.500000000000000000d0,0d0
     &,0d0,0.166666666666666667d0
     &/
      data ic15/0.250000000000000000d0,0.250000000000000000d0
     &,0.250000000000000000d0,0.166666666666666667d0
     &/
      data ic16/0.333333333333333333d0,0.333333333333333333d0
     &,0d0,-0.281250000000000000d0
     &,0.600000000000000000d0,0.200000000000000000d0
     &,0d0,0.260416666666666667d0
     &,0.200000000000000000d0,0.600000000000000000d0
     &,0d0,0.260416666666666667d0
     &,0.200000000000000000d0,0.200000000000000000d0
     &,0d0,0.260416666666666667d0
     &/
      data ic17/0d0,0d0
     &,0d0,0.0250000000000000000d0
     &,0.500000000000000000d0,0d0
     &,0d0,0.0666666666666666667d0
     &,1.00000000000000000d0,0d0
     &,0d0,0.0250000000000000000d0
     &,0.500000000000000000d0,0.500000000000000000d0
     &,0d0,0.0666666666666666667d0
     &,0d0,1.00000000000000000d0
     &,0d0,0.0250000000000000000d0
     &,0d0,0.500000000000000000d0
     &,0d0,0.0666666666666666667d0
     &,0.333333333333333333d0,0.333333333333333333d0
     &,0d0,0.225000000000000000d0
     &/
      data ic18/0.585410196624968454d0,0.138196601125010515d0
     &,0.138196601125010515d0,0.0416666666666666667d0
     &,0.138196601125010515d0,0.585410196624968454d0
     &,0.138196601125010515d0,0.0416666666666666667d0
     &,0.138196601125010515d0,0.138196601125010515d0
     &,0.585410196624968454d0,0.0416666666666666667d0
     &,0.138196601125010515d0,0.138196601125010515d0
     &,0.138196601125010515d0,0.0416666666666666667d0
     &/
      data ic19/0.250000000000000000d0,0.250000000000000000d0
     &,0.250000000000000000d0,-0.133333333333333333d0
     &,0.500000000000000000d0,0.166666666666666667d0
     &,0.166666666666666667d0,0.0750000000000000000d0
     &,0.166666666666666667d0,0.500000000000000000d0
     &,0.166666666666666667d0,0.0750000000000000000d0
     &,0.166666666666666667d0,0.166666666666666667d0
     &,0.500000000000000000d0,0.0750000000000000000d0
     &,0.166666666666666667d0,0.166666666666666667d0
     &,0.166666666666666667d0,0.0750000000000000000d0
     &/
      data ic20/0d0,0d0
     &,0d0,2.00000000000000000d0
     &/
      data ic21/-0.577350269189625765d0,0d0
     &,0d0,1.00000000000000000d0
     &,0.577350269189625765d0,0d0
     &,0d0,1.00000000000000000d0
     &/
      data ic22/-0.774596669241483377d0,0d0
     &,0d0,0.555555555555555556d0
     &,0d0,0d0
     &,0d0,0.888888888888888889d0
     &,0.774596669241483377d0,0d0
     &,0d0,0.555555555555555556d0
     &/
      data ic23/-0.861136311594052575d0,0d0
     &,0d0,0.347854845137453857d0
     &,-0.339981043584856265d0,0d0
     &,0d0,0.652145154862546143d0
     &,0.339981043584856265d0,0d0
     &,0d0,0.652145154862546143d0
     &,0.861136311594052575d0,0d0
     &,0d0,0.347854845137453857d0
     &/
      data ic24/-0.906179845938663993d0,0d0
     &,0d0,0.236926885056189087d0
     &,-0.538469310105683091d0,0d0
     &,0d0,0.478628670499366468041d0
     &,0d0,0d0
     &,0d0,0.5688888888888888888888d0
     &,0.538469310105683091d0,0d0
     &,0d0,0.4786286704993664680412d0
     &,0.906179845938663993d0,0d0
     &,0d0,0.2369268850561890875142d0
     &/
      if(icode.eq.0) then
        ngpo=0
        return
      endif
      goto(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18
     &,19,20,21,22,23,24),icode
      write(*,*)"unknown integration code"
      stop

1     ngpo=1
      do i=1,4
        gp(i)=ic1(i)
      enddo
      return
2     ngpo=4
      do i=1,16
        gp(i)=ic2(i)
      enddo
      return
3     ngpo=9
      do i=1,36
        gp(i)=ic3(i)
      enddo
      return
4     ngpo=5
      do i=1,20
        gp(i)=ic4(i)
      enddo
      return
5     ngpo=4
      do i=1,16
        gp(i)=ic5(i)
      enddo
      return
6     ngpo=1
      do i=1,4
        gp(i)=ic6(i)
      enddo
      return
7     ngpo=8
      do i=1,32
        gp(i)=ic7(i)
      enddo
      return
8     ngpo=27
      do i=1,108
        gp(i)=ic8(i)
      enddo
      return
9     ngpo=64
      do i=1,256
        gp(i)=ic9(i)
      enddo
      return
10     ngpo=9
      do i=1,36
        gp(i)=ic10(i)
      enddo
      return
11     ngpo=8
      do i=1,32
        gp(i)=ic11(i)
      enddo
      return
12     ngpo=1
      do i=1,4
        gp(i)=ic12(i)
      enddo
      return
13     ngpo=3
      do i=1,12
        gp(i)=ic13(i)
      enddo
      return
14     ngpo=3
      do i=1,12
        gp(i)=ic14(i)
      enddo
      return
15     ngpo=1
      do i=1,4
        gp(i)=ic15(i)
      enddo
      return
16     ngpo=4
      do i=1,16
        gp(i)=ic16(i)
      enddo
      return
17     ngpo=7
      do i=1,28
        gp(i)=ic17(i)
      enddo
      return
18     ngpo=4
      do i=1,16
        gp(i)=ic18(i)
      enddo
      return
19     ngpo=5
      do i=1,20
        gp(i)=ic19(i)
      enddo
      return
20     ngpo=1
      do i=1,4
        gp(i)=ic20(i)
      enddo
      return
21     ngpo=2
      do i=1,8
        gp(i)=ic21(i)
      enddo
      return
22     ngpo=3
      do i=1,12
        gp(i)=ic22(i)
      enddo
      return
23     ngpo=4
      do i=1,16
        gp(i)=ic23(i)
      enddo
      return
24     ngpo=5
      do i=1,20
        gp(i)=ic24(i)
      enddo
      return

      END

      double precision FUNCTION SMSDeltaPart(a,i,j,k)
      double precision a(*)
      integer i,j,k,l
      l=i/j
      IF(mod(i,j).ne.0 .or. l.gt.k) then
          SMSDeltaPart=0d0
      else
          SMSDeltaPart=a(l)
      endif
      end

      double precision FUNCTION SMSMAX(a,b)
      double precision a,b
      IF(a>b) then
          SMSMAX=a
      else
          SMSMAX=b
      endif
      end

      double precision FUNCTION SMSMIN(a,b)
      double precision a,b
      IF(a>b) then
          SMSMIN=b
      else
          SMSMIN=a
      endif
      end


      double precision function SMSDot(a,b,n)
      double precision a(*),b(*)
      integer i,n
      SMSDot=0.d0
      Do i=1,n
        SMSDot=SMSDot+a(i)*b(i)
      EndDo
      End

      double precision function SMSSum(a,n)
      double precision a(*)
      integer i,n
      SMSSum=0.d0
      Do i=1,n
        SMSSum=SMSSum+a(i)
      EndDo
      End

      double precision FUNCTION SMSKDelta(i,j)
c     Kronnecker delta
      INTEGER i,j
      IF (i.eq.j) THEN 
       SMSKDelta=1.0d0
      ELSE
       SMSKDelta=0.0d0
      END IF
      END FUNCTION
 
      subroutine SMSMove(a,b,n)
      double precision a(n),b(n)
      integer i,n
      do 1 i=1,n
1       b(i)=a(i)
      end

      subroutine SMSZero(a,n)
      double precision a(n)
      integer i,n
      do 1 i=1,n
1       a(i)=0d0
      end
         
      subroutine SMSSRecover(hb,ha,du,dh,nb,ne)
      double precision ha(ne,nb),hb(ne),du(nb),dh(ne)
      do i = 1,ne
        dh(i) = hb(i)
        do j = 1,nb
          dh(i) = dh(i) - ha(i,j)*du(j)
        end do
      end do
      end

      subroutine SMSSCondense(s,sc,p,pc,hb,ha,nb,ne)
      double precision s(nb+ne,nb+ne),sc(nb,nb),p(nb+ne),pc(nb),
     -  ha(ne,nb),hb(ne),d
      integer i,j,k,n,nmax
      nmax=nb+ne
c.... invert cc
      do n = nb+1,nmax
      if(s(n,n).ne.0.0d0) then
          d = 1.d0/s(n,n)
          do j = nb+1,nmax
            s(n,j) = -s(n,j)*d
          end do
          do i = nb+1,nmax
            if(n.ne.i) then
              do j = nb+1,nmax
                if(n.ne.j) s(i,j) = s(i,j) +s(i,n)*s(n,j)
              end do
            endif
            s(i,n) = s(i,n)*d
          end do
          s(n,n) = d
      endif
      end do

c.....matrices needed for recovery ha=Shh^-1 Shu^T ,hb=Shh^-1 pe
      do i = nb+1,nmax
        do j = 1,nb
          d=0.d0
          do k=nb+1,nmax
             d=d+s(i,k)*s(k,j)
          enddo
          ha(i-nb,j)=d
        end do
      end do

      do i = nb+1,nmax
        d=0.d0
        do j=nb+1,nmax
          d=d+s(i,j)*p(j)
        enddo
        hb(i-nb)=d
      end do

      do i = 1,nb
       do j = 1,nb
        d=s(i,j)
        do k=nb+1,nmax
           d = d - s(i,k)*ha(k-nb,j)
        enddo
        sc(i,j)=d
       end do
      end do

      do i = 1,nb
        d=p(i)
        do k=nb+1,nmax 
          d = d-s(i,k)*hb(k-nb)
        enddo
        pc(i)=d
      end do
      end
